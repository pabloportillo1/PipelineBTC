<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pipeline BTC ‚Äî Diagrama de Arquitectura</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #0f1117;
      color: #e2e8f0;
      min-height: 100vh;
      padding: 40px 20px;
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      color: #f7931a;
      margin-bottom: 6px;
      letter-spacing: 1px;
    }

    .subtitle {
      text-align: center;
      color: #94a3b8;
      font-size: 0.95rem;
      margin-bottom: 50px;
    }

    /* ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ */
    .section-label {
      text-align: center;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #64748b;
      margin-bottom: 8px;
    }

    .input-box {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }

    .input-card {
      background: #1e293b;
      border: 2px solid #334155;
      border-radius: 12px;
      padding: 16px 32px;
      text-align: center;
      min-width: 280px;
    }

    .input-card .title {
      font-size: 1rem;
      font-weight: 700;
      color: #e2e8f0;
      margin-bottom: 10px;
    }

    .field-row {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .field-tag {
      background: #0f172a;
      border: 1px solid #475569;
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 0.78rem;
      color: #94a3b8;
      font-family: monospace;
    }

    /* ‚îÄ‚îÄ ARROW ‚îÄ‚îÄ */
    .arrow-down {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 4px 0;
    }

    .arrow-line {
      width: 2px;
      height: 28px;
      background: linear-gradient(to bottom, #f7931a, #fb923c);
    }

    .arrow-head {
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 12px solid #fb923c;
    }

    /* ‚îÄ‚îÄ PIPELINE CONTAINER ‚îÄ‚îÄ */
    .pipeline {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    /* ‚îÄ‚îÄ FILTER CARD ‚îÄ‚îÄ */
    .filter-card {
      width: 680px;
      max-width: 95vw;
      border-radius: 14px;
      border: 2px solid;
      overflow: hidden;
      box-shadow: 0 4px 24px rgba(0,0,0,0.4);
    }

    .filter-header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 20px;
    }

    .filter-number {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1rem;
      flex-shrink: 0;
      color: #fff;
    }

    .filter-title {
      font-size: 1.05rem;
      font-weight: 700;
    }

    .filter-subtitle {
      font-size: 0.78rem;
      opacity: 0.75;
      margin-top: 2px;
    }

    .filter-body {
      background: #0f1117;
      padding: 14px 20px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .filter-col {
      flex: 1;
      min-width: 180px;
    }

    .col-label {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #64748b;
      margin-bottom: 6px;
    }

    .col-item {
      font-size: 0.82rem;
      color: #cbd5e1;
      padding: 3px 0;
      padding-left: 12px;
      position: relative;
    }

    .col-item::before {
      content: '‚ñ∏';
      position: absolute;
      left: 0;
      color: #64748b;
    }

    .enriches-tag {
      display: inline-block;
      font-size: 0.72rem;
      font-family: monospace;
      background: #1e293b;
      border-radius: 4px;
      padding: 2px 7px;
      margin: 2px 2px 0 0;
      color: #7dd3fc;
      border: 1px solid #334155;
    }

    /* Filter color themes */
    .f1 { border-color: #3b82f6; }
    .f1 .filter-header { background: linear-gradient(135deg, #1d4ed8, #2563eb); }
    .f1 .filter-number { background: #1d4ed8; }
    .f1 .filter-title  { color: #bfdbfe; }

    .f2 { border-color: #8b5cf6; }
    .f2 .filter-header { background: linear-gradient(135deg, #6d28d9, #7c3aed); }
    .f2 .filter-number { background: #6d28d9; }
    .f2 .filter-title  { color: #ddd6fe; }

    .f3 { border-color: #f59e0b; }
    .f3 .filter-header { background: linear-gradient(135deg, #b45309, #d97706); }
    .f3 .filter-number { background: #b45309; }
    .f3 .filter-title  { color: #fde68a; }

    .f4 { border-color: #10b981; }
    .f4 .filter-header { background: linear-gradient(135deg, #065f46, #059669); }
    .f4 .filter-number { background: #065f46; }
    .f4 .filter-title  { color: #a7f3d0; }

    .f5 { border-color: #ef4444; }
    .f5 .filter-header { background: linear-gradient(135deg, #991b1b, #dc2626); }
    .f5 .filter-number { background: #991b1b; }
    .f5 .filter-title  { color: #fecaca; }

    /* ‚îÄ‚îÄ OUTPUT ‚îÄ‚îÄ */
    .output-box {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }

    .output-card {
      background: #14532d;
      border: 2px solid #16a34a;
      border-radius: 12px;
      padding: 16px 32px;
      text-align: center;
      min-width: 280px;
    }

    .output-card .title {
      font-size: 1rem;
      font-weight: 700;
      color: #86efac;
      margin-bottom: 10px;
    }

    /* ‚îÄ‚îÄ DATA STORE ‚îÄ‚îÄ */
    .datastores {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 50px;
      flex-wrap: wrap;
    }

    .datastore {
      background: #1e293b;
      border: 2px dashed #475569;
      border-radius: 12px;
      padding: 16px 24px;
      text-align: center;
      min-width: 180px;
    }

    .datastore .ds-icon { font-size: 2rem; margin-bottom: 6px; }
    .datastore .ds-name { font-size: 0.9rem; font-weight: 700; color: #e2e8f0; }
    .datastore .ds-desc { font-size: 0.75rem; color: #64748b; margin-top: 4px; }

    /* ‚îÄ‚îÄ LEGEND ‚îÄ‚îÄ */
    .legend {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: #94a3b8;
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer {
      text-align: center;
      margin-top: 50px;
      color: #475569;
      font-size: 0.78rem;
    }
  </style>
</head>
<body>

  <h1>üîó Pipeline de Transacciones BTC</h1>
  <p class="subtitle">Patr√≥n Arquitect√≥nico Pipe-and-Filter ‚Äî 5 Etapas de Procesamiento</p>

  <!-- INPUT -->
  <div class="section-label">Entrada</div>
  <div class="input-box">
    <div class="input-card">
      <div class="title">üì• Transacci√≥n de Entrada</div>
      <div class="field-row">
        <span class="field-tag">user_id</span>
        <span class="field-tag">btc_amount</span>
        <span class="field-tag">currency (USD|EUR|GBP)</span>
      </div>
    </div>
  </div>

  <!-- PIPELINE -->
  <div class="pipeline">

    <!-- Arrow -->
    <div class="arrow-down"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Filter 1 -->
    <div class="filter-card f1">
      <div class="filter-header">
        <div class="filter-number">1</div>
        <div>
          <div class="filter-title">ValidationFilter</div>
          <div class="filter-subtitle">Filtro de Validaci√≥n</div>
        </div>
      </div>
      <div class="filter-body">
        <div class="filter-col">
          <div class="col-label">Responsabilidades</div>
          <div class="col-item">Verifica campos obligatorios</div>
          <div class="col-item">Valida tipos de datos</div>
          <div class="col-item">Comprueba btc_amount > 0</div>
          <div class="col-item">Valida moneda (USD/EUR/GBP)</div>
          <div class="col-item">Normaliza currency a may√∫sculas</div>
        </div>
        <div class="filter-col">
          <div class="col-label">Agrega al contexto</div>
          <span class="enriches-tag">validation_status</span>
          <span class="enriches-tag">currency (normalizado)</span>
        </div>
        <div class="filter-col">
          <div class="col-label">Errores posibles</div>
          <div class="col-item">ValueError ‚Äî campo faltante</div>
          <div class="col-item">TypeError ‚Äî tipo incorrecto</div>
          <div class="col-item">ValueError ‚Äî moneda inv√°lida</div>
        </div>
      </div>
    </div>

    <div class="arrow-down"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Filter 2 -->
    <div class="filter-card f2">
      <div class="filter-header">
        <div class="filter-number">2</div>
        <div>
          <div class="filter-title">AuthenticationFilter</div>
          <div class="filter-subtitle">Filtro de Autenticaci√≥n</div>
        </div>
      </div>
      <div class="filter-body">
        <div class="filter-col">
          <div class="col-label">Responsabilidades</div>
          <div class="col-item">Carga base de datos users.json</div>
          <div class="col-item">Busca user_id en el registro</div>
          <div class="col-item">Verifica cuenta activa</div>
          <div class="col-item">Enriquece con perfil del usuario</div>
        </div>
        <div class="filter-col">
          <div class="col-label">Agrega al contexto</div>
          <span class="enriches-tag">authenticated</span>
          <span class="enriches-tag">user_name</span>
          <span class="enriches-tag">user_email</span>
          <span class="enriches-tag">user_role</span>
        </div>
        <div class="filter-col">
          <div class="col-label">Errores posibles</div>
          <div class="col-item">PermissionError ‚Äî usuario no existe</div>
          <div class="col-item">PermissionError ‚Äî cuenta inactiva</div>
          <div class="col-item">FileNotFoundError ‚Äî BD no encontrada</div>
        </div>
      </div>
    </div>

    <div class="arrow-down"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Filter 3 -->
    <div class="filter-card f3">
      <div class="filter-header">
        <div class="filter-number">3</div>
        <div>
          <div class="filter-title">TransformationFilter</div>
          <div class="filter-subtitle">Filtro de Transformaci√≥n ‚Äî API REST (simulada)</div>
        </div>
      </div>
      <div class="filter-body">
        <div class="filter-col">
          <div class="col-label">Responsabilidades</div>
          <div class="col-item">Llama API REST de precios BTC</div>
          <div class="col-item">Obtiene tasa de cambio BTC/moneda</div>
          <div class="col-item">Calcula valor total (BTC √ó precio)</div>
          <div class="col-item">Registra fuente y timestamp del precio</div>
        </div>
        <div class="filter-col">
          <div class="col-label">Agrega al contexto</div>
          <span class="enriches-tag">btc_price</span>
          <span class="enriches-tag">total_value</span>
          <span class="enriches-tag">api_source</span>
          <span class="enriches-tag">price_timestamp</span>
        </div>
        <div class="filter-col">
          <div class="col-label">Tasas simuladas</div>
          <div class="col-item">1 BTC = 65,000.00 USD</div>
          <div class="col-item">1 BTC = 60,500.00 EUR</div>
          <div class="col-item">1 BTC = 51,800.00 GBP</div>
        </div>
      </div>
    </div>

    <div class="arrow-down"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Filter 4 -->
    <div class="filter-card f4">
      <div class="filter-header">
        <div class="filter-number">4</div>
        <div>
          <div class="filter-title">FeeFilter</div>
          <div class="filter-subtitle">Filtro de C√°lculo de Comisiones</div>
        </div>
      </div>
      <div class="filter-body">
        <div class="filter-col">
          <div class="col-label">Responsabilidades</div>
          <div class="col-item">Aplica comisi√≥n fija de 5.00 USD</div>
          <div class="col-item">Convierte comisi√≥n a moneda base</div>
          <div class="col-item">Calcula total final (subtotal + fee)</div>
        </div>
        <div class="filter-col">
          <div class="col-label">Agrega al contexto</div>
          <span class="enriches-tag">fee</span>
          <span class="enriches-tag">fee_currency</span>
          <span class="enriches-tag">fee_usd_base</span>
          <span class="enriches-tag">subtotal</span>
          <span class="enriches-tag">total_with_fee</span>
        </div>
        <div class="filter-col">
          <div class="col-label">Comisiones por moneda</div>
          <div class="col-item">USD: 5.00</div>
          <div class="col-item">EUR: 4.62</div>
          <div class="col-item">GBP: 3.96</div>
        </div>
      </div>
    </div>

    <div class="arrow-down"><div class="arrow-line"></div><div class="arrow-head"></div></div>

    <!-- Filter 5 -->
    <div class="filter-card f5">
      <div class="filter-header">
        <div class="filter-number">5</div>
        <div>
          <div class="filter-title">StorageFilter</div>
          <div class="filter-subtitle">Filtro de Almacenamiento ‚Äî SQLite</div>
        </div>
      </div>
      <div class="filter-body">
        <div class="filter-col">
          <div class="col-label">Responsabilidades</div>
          <div class="col-item">Inicializa tabla SQLite si no existe</div>
          <div class="col-item">Genera UUID √∫nico de transacci√≥n</div>
          <div class="col-item">Inserta registro completo en BD</div>
          <div class="col-item">Asigna timestamp e ISO y estado final</div>
        </div>
        <div class="filter-col">
          <div class="col-label">Agrega al contexto</div>
          <span class="enriches-tag">transaction_id</span>
          <span class="enriches-tag">timestamp</span>
          <span class="enriches-tag">status = "completed"</span>
        </div>
        <div class="filter-col">
          <div class="col-label">Persistencia</div>
          <div class="col-item">Base de datos: SQLite</div>
          <div class="col-item">Archivo: data/transactions.db</div>
          <div class="col-item">Tabla: transactions</div>
          <div class="col-item">13 columnas almacenadas</div>
        </div>
      </div>
    </div>

    <div class="arrow-down"><div class="arrow-line"></div><div class="arrow-head"></div></div>

  </div>

  <!-- OUTPUT -->
  <div class="section-label">Salida</div>
  <div class="output-box">
    <div class="output-card">
      <div class="title">‚úÖ Transacci√≥n Procesada</div>
      <div class="field-row">
        <span class="field-tag" style="color:#86efac">transaction_id</span>
        <span class="field-tag" style="color:#86efac">total_with_fee</span>
        <span class="field-tag" style="color:#86efac">status: completed</span>
        <span class="field-tag" style="color:#86efac">timestamp</span>
      </div>
    </div>
  </div>

  <!-- DATA STORES -->
  <div class="datastores">
    <div class="datastore">
      <div class="ds-icon">üìÑ</div>
      <div class="ds-name">users.json</div>
      <div class="ds-desc">Base de datos de usuarios<br/>(Mock RDS / DynamoDB)</div>
    </div>
    <div class="datastore">
      <div class="ds-icon">üóÑÔ∏è</div>
      <div class="ds-name">transactions.db</div>
      <div class="ds-desc">Base de datos SQLite<br/>Persistencia de transacciones</div>
    </div>
    <div class="datastore">
      <div class="ds-icon">üåê</div>
      <div class="ds-name">MockBTCPriceAPI</div>
      <div class="ds-desc">API REST simulada<br/>Tasas de cambio BTC</div>
    </div>
  </div>

  <!-- LEGEND -->
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div>Validaci√≥n</div>
    <div class="legend-item"><div class="legend-dot" style="background:#8b5cf6"></div>Autenticaci√≥n</div>
    <div class="legend-item"><div class="legend-dot" style="background:#f59e0b"></div>Transformaci√≥n</div>
    <div class="legend-item"><div class="legend-dot" style="background:#10b981"></div>Comisiones</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ef4444"></div>Almacenamiento</div>
  </div>

  <footer>
    <p>Patr√≥n Pipe-and-Filter ¬∑ Python 3 ¬∑ SQLite ¬∑ Mock REST API</p>
    <p style="margin-top:4px">Arquitectura de Software ‚Äî Pipeline BTC Transaction Processor</p>
  </footer>

</body>
</html>
